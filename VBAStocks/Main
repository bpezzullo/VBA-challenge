Sub Main()
Dim Ticker_cell As Integer
Dim Start As String
Dim Found As String
Dim rowct As Long
Dim continue As Boolean
Dim Volcell1 As String
Dim Volcell2 As String
Dim test As String

'initialize variables
'Ticker_cell keeps track on what row to store the results.  Start with the second row
'Start is the initial ticker name space
'Found is the Ticker found from the function
'Rowct is used to determine where in the spreadsheet the Ticker changes. Start with 1
'Continue is used to control the loop


Ticker_cell = 2
rowct = 1
Found = Cells(1, rowct).Value
Start = Found
continue = True
Range("I1") = "Ticker"
Range("J1") = "Yearly Change"
Range("K1") = "Percent Change"
Range("L1") = "Volume"

' Loop until the end of the spreadsheet
' Call the function Identity_ticker to find the next company.  Store the row information to determine where
' the comapny starts or stops in the spreadsheet

Do While continue = True

 rowct = Identify_ticker(Start, Found, rowct)   ' start from the last spot rowct
 'MsgBox (Str(rowct))
 Found = Cells(rowct, 1).Value                  ' Change of ticker symbol so save it in the appropriate row
 Cells(Ticker_cell, 9).Value = Found            ' Place in the spreadsheet at the appropriate location

 Cells(Ticker_cell, 20).Value = rowct           ' Need to convert this to an array instead of saving on the spreadsheet
 
 
 
 ' I couldn't figure out how to call the spreadsheet sum so created my own function for now.
  
 If rowct > 2 Then
    'MsgBox (Str(rowct) + Str(Ticker_cell) + Str(Cells(Ticker_cell - 1, 20).Value) + Str(Cells(rowct - 1, 6).Value)) + Str(Cells(Cells(Ticker_cell - 1, 20).Value, 3).Value)
    Cells(Ticker_cell - 1, 10).Value = Cells(rowct - 1, 6).Value - Cells(Cells(Ticker_cell - 1, 20).Value, 3).Value
    Cells(Ticker_cell - 1, 11).Value = Cells(Ticker_cell - 1, 10).Value / Cells(Cells(Ticker_cell - 1, 20).Value, 3).Value
    Cells(Ticker_cell - 1, 12).Value = Sum_man(Cells(Ticker_cell - 1, 20).Value, rowct - 1)
    
    End If
 
 ' Increase the row for the next ticker symbol
 Ticker_cell = Ticker_cell + 1
 
 ' reset the Start variable for the while loop
 
 Start = Found
 
 ' Are we at the end of the spreadsheet. If so jump out of the while loop
  'If Found = "AAN" Then continue = False  'reset to "" when done testing
  
  If Found = "" Then continue = False

 ' Get the next sticker
 Loop




End Sub

Function Identify_ticker(Start As String, Found As String, rowct As Long) As Long

' Find the next ticker
' Hold is a temporary field

Dim Hold As String
Dim i As Long
Dim ticker_continue As Boolean

i = rowct
ticker_continue = True

' Loop until the next sysmbol, but added a restriction of only 1000 cells
Do While ticker_continue = True

Hold = Cells(i, 1).Value
If Start <> Hold Then           ' Found a new ticker symbol
    Found = Hold
    Identify_ticker = i         ' return the row of the new ticker symbol
    ticker_continue = False     ' Exit from the function
Else
    i = i + 1
    End If
Loop

End Function

Function Sum_man(First As Long, Second As Long) As Double
 Dim result As Double
 
 result = 0
 
For i = First To Second
 result = result + Cells(i, 7).Value
 Next i
 
 Sum_man = result

End Function
